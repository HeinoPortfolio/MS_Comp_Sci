---
title: "Grouped Histogram in R"
author: "Matthew Heino"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```
# Data Description

The data is from the CSV file with the file name "Sampledata2.csv". The data represents the crime rate by state over a period of time.  The range of years is from 2007 to 2018. The data set is composed of three columns or variables. The columns are the following:

* Variable 1: **State** - holds the name of the state where the data was collected
* Variable 2: **Year** - the year in which the data was collected
* Variable 3: **CrimeRate** - the crime rate

# Data Wrangling

The data needed to be prepared before it could be processed.  The steps are the following:

* Step 1: Read in the data from the CSV file ("Sampledata2.csv")
* Step 2: View the contents of the data frame
* Step 3: Create the color vectors.
* Step 4: Create the RangeGroup column.
* Step 5: Create the first histogram based on the crime rate and the year and utilize the first color vector.
* Step 6: Create the second histogram based on the crime rate and the RangeGroup and utilize the second color vector.

Loading the appropriate packages will also be necessary.

**Note:** The classic theme has not been used. 


### Load the required packages

The required packages:

* tidyverse - to provide plotting functions and other functionality 
* colorspace - provide the color functions that are required to create colors for the graphs

The working directory was also set. 

```{r message=FALSE}

if(!require(colorspace)) {install.packages('colorspace')}; require(colorspace)
if(!require(tidyverse)) {install.packages('tidyverse')}; require(tidyverse)

library(tidyverse)
library(colorspace)

#Set the working directory
setwd(dirname(rstudioapi::getSourceEditorContext()$path))

```

### 1) Read in the data from the CSV file

Read in the data from the CSV file with the file name "Sampledata2.csv". Show the first six rows of the data frame and the last six rows to show what is in the data set.  This was see what is in the data. 

```{r}

crime_rate_df <- read.csv("Sampledata2.csv")

```

### 2) Inspect the data

View the composition of the data and see what columns are included. 
```{r}

head(crime_rate_df)
tail(crime_rate_df)

```
The data set is composed of the following columns:

* State - holds the name of the state where the data was collected
* Year - the year in which the data was collected
* CrimeRate - the crime rate

### 3) Create a new column for the Range Group
In order to accomplish the graphs that are required.  There will be three variables.  The first two are available from the data set. The third is a newly created variable - the **RangeGroup**. This variable will group the crime rates into three distinct groups. The groups are the following:

* Crime Rate < 250
* 250 <= Crime Rate <= 500
* Crime Rate > 500

Select the year and crime rate for use in the graphs that will be created later and then group the crime rates based on what group they belong to.  This was accomplished using the **case_when** statement.

```{r}

new_crime_rate_df <- crime_rate_df %>% select(Year, CrimeRate) %>%
  mutate(RangeGroup = case_when(CrimeRate < 250 ~ "Crime Rate < 250",
                                250 <= CrimeRate &  CrimeRate <= 500 ~ "250 <= Crime Rate <= 500",
                                CrimeRate > 500 ~ "Crime Rate > 500"))

```

### 4) Create the color vectors for the graphs

This section of code will create the first vector of colors. This first vector is based on the number of distinct years in the data set.  The second is coded with the colors red, blue, and green. These colors will be used to show the groups of the different crime rates.

```{r}

# Create the first color vector
n_col = length(unique(new_crime_rate_df$Year))
col1 = colorspace::diverge_hcl(n_col)

# Create the second color vector
col2 = c("green","blue","red")

```


### 5) Histogram of the Crime Rate using the Year

This is the histogram of the crime rate using Year and the first selection of colors.This is variable **col1** from the previous section. 
This histogram includes all the years that were included in the provided data set.The years ran from 2007 to 2018.  

```{r}

new_crime_rate_df %>% 
  ggplot(aes(x=CrimeRate, color=as.factor(Year), fill=as.factor(Year))) +
  geom_histogram(position = "dodge", alpha=0.5, bins=10) +
  scale_color_manual(values=col1) +
  scale_fill_manual(values=col1, name="Year") +
  labs(title="Crime Rate Histogram Plot By Year", x="Crime rate per 100, 1000 people",
       y="Count", color="Year") +
  theme(plot.title=element_text(hjust=0.5))

```

### 6) Histogram of the Crime Rate using Range Group

This is the histogram of the crime rate using Range Group and the second selection of colors. The second color variable is **col2**.
This histogram displays a ranged group based on the range into which the crime rate falls.   

```{r}
new_crime_rate_df %>%
  ggplot(aes(x=CrimeRate, color=as.factor(RangeGroup), fill=as.factor(RangeGroup))) + 
  geom_histogram(position = "dodge", alpha=0.5, bins=10) +
  scale_color_manual(values=col2) +
  scale_fill_manual(values=col2, name="Range Group") +
  labs(title="Crime Rate Histogram Plot (Range Group)", x="Crime rate per 100, 1000 people",
       y="Count", color="Range Group") +
  theme(plot.title=element_text(hjust=0.5))
```


